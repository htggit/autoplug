# MicroCommand: Vim 微命令集

## 介绍

最常用的 vim 操作适用于用映射（map）按个人习惯定制。但另有一些很有用但操作不那
么频繁的，则用自定义命令（command）将比映射更方便。

* 映射按键资源有限，当需要按三、四个键以上的操作时，就显得很制肘了。而若放眼于
  命令，只需额外增加一个冒号与回车（`:Command<CR>`），便能得到极大扩展。
* 命令可带参数，做些类似而不同的事情。对于默认参数与最常用参数用法，仍可用映射
  加速访问。
* 命令可以做更复杂的事件，可简化复杂映射的理解。
* 命令可以有自动补全功能，简化记忆。
* 输入命令的确认感比映射键强，输错了也方便修改。

许多优秀的插件，也提供了命令。不过当使用者按推荐或按自己习惯配置好映射键后，几
乎都忘了使用其命令。同时各插件编写者，为了避免各自定义的命令不致冲突，往往将命
令名定义得比较长，导致使用不便。

我这里提供一种思路，将一些有用却不常用的操作从映射扩展为“微命令”，使用一至两个大
写字母（VIM的自定义命令规定以大写字母开始）。在各插件普遍使用长命令的情况下，
短命令也取巧避免了冲突呢。若果真有冲突，则使用时像解决键冲突一样修改配置即可。
本人目前提供的插件，`plugin/*.vim`都只是简单配置，`autoload/*.vim`才是实际可用
的功能。

## 既有功能

先列出已实现的命令功能，有时间继续增加。

### A ED EA DA E D：双窗口编辑命令
详见另一个插件 [EDvsplit](https://github.com/lymslive/EDvsplit)。
E 表示当前窗口（如内置 e 命令也是在当前窗口编辑），D 表示另一个目标窗口。A 表
示另一个相关文件（如在 vim.org 中曾有人提供的 C 语言插件 a.vim）。

### EV：编辑 vim 文件

* `:EV` 无参数，打开当前 vimrc 配置文件，相当于 :e $MYVIMRC
* `:EV .` 一个点作为参数，打开自己 vim 配置目录下（$VIMHOME）的文件类型插件
  ftplugin/ 中与当前文件类型相关的插件。如正在编辑 cpp 文件时，打开
  ftplugin/cpp.vim。
  
$VIMHOME 在 unix 类系统下一般是 ~/.vim，windows 系统则是安装目录的 vimfiles/。
如果未定义，则可在 vimrc 中加入其定义。
```
if has('win32') || has ('win64')
    let $VIMHOME = $VIM."/vimfiles"
else
    let $VIMHOME = $HOME."/.vim"
endif
```

vimrc 代表着个人当前使用的 vim 全局配置，`ftplugin/*.vim`则代表着与文件类型相
关的局部配置，可能需要经常调整。

EV 的命名，可记为 Edit Vim file，也可认为是 Environment （环境）。

* `:EV [one-arg]` 如果带一个参数，则将在 &rtp(runtimepath) 路径及其 plugin/ 子目
  录下查找相关的 .vim 文件，若找到则打开编辑。支持 Tab 补全。如果参数是带 `#`
  的自动加载函数，则会搜索该函数的定义并打开（包括未加载的 `pack/*/opt` 目录）。

* `:EV ,` 一个逗号作为参数，执行 `:UltiSnipsEdit` 快捷命令，编辑与当前文件类型相
  关的 snips 文件。需要安装[UltiSnips](https://github.com/SirVer/ultisnips)插
  件。如果用了该插件，一般会维护自己的一份 snips 文件，你可能需要不时去调整或
  查看提供了哪些 snips 。因此与点号参数一样，算是与文件类型相关的定制需求。

### H: help 帮助命令增强

* `:H [topic]` 与 `:help` 相同，但在无参数时以当前光标所在的单词作为帮助主题词。
* `:HV [topic]` 纵向分割窗口以显示帮助主题。
* `:HT [topic]` 在新 tab 页是显示帮助主题。
* `:HH` 再次显示上次打开的帮助主题。

`H[VT]` 命令会记录所搜索的帮助主题词历史列表，如果提供的参数是整数而非字符串，
则重复显示历史列表中的帮助主题。`HH` 命令即相当于提供`-1`参数，取历史列表的最
后一条。历史列表中 VIM 退出后不保存。

内置的 `:help` 命令会自动选择当前页已存在的帮助窗口，但不会跳到其他 tabpag 页
可能已存在的帮助窗口。使用这里的 `:H` 命令则也会检测其他标签页的帮助窗口复用。

因为帮助文档是只读的，推荐在 `ftplugin/help.vim` 中加下如下映射，方便浏览阅读：
```
nnoremap <buffer> i <C-]>
nnoremap <buffer> a <C-T>
nnoremap <buffer> q :q<CR>
```

同时，在 vim 脚本的文件类型插件 `ftplugin/vim.vim` 中可推荐如下映射：
```
nnoremap <buffer> K :help expand('<cword>')<CR>
```
或者，若使用了本插件，可用如下等效的简化命令
```
nnoremap <buffer> K :H<CR>
```

K 的内置功能是调用系统的手册命令 `man` ，这在写 C 语言程序查看库函数或 bash 脚
本查看命令手册挺有用，但在写 vim 脚本时，理应查看其自身的 help 文档系统才是。

### SET: 切换设置选项命令

* `:SET <bool option>` 一个参数为布尔型的选项，切换该选项的 0/1 生效值。
  如 `SET number` 表示在 `set number` 与 `set nonumber` 之间切换。
* `:SET <list option> <contain value>` 两个参数，用于复合值的选项。
  如 `SET go t` 表示在 `set go+=t` 与 `set go-=t` 之间切换。
* `:SET <option> <value1> <value2>` 三个参数，用于将一个选项的值在两个最常用的
  值之间切换。
* `:SET` 无参数时，重复上次的切换式 SET 命令。
* `:SET <-n>` 一个整数参数，一般是负整数，重复历史列表的某个 SET 切换命令，默
  认 -1 就是无参数的情形。该历史列表也只在当前会话生效。
* `:SET <option[+-]=value>` 在只有一个参数且包含等号 `=` 时，SET 命令退化为内
  置的 set 命令，并且不会再添加到 SET 命令的历史列表中，因为直接的 set 命令没
  有切换的功能。

推荐可将 `:SET` 命令作一个映射键，这样在临时修改一个选项后，可以反复切换效果。

在定义命令名时，使用了 `SET` 三个字母，但按 VIM 搜索命令的规则，在不会有缩写冲
突的情况下，只输入 `SE` 甚至单 `S` 也是可以的。

### P: 特殊粘贴命令

推荐常规 `p` 命令在粘贴后自动重格式化：p=\`]\`]。在这一般使用是很方便。但偶
尔要用到保留源格式化的粘贴该如何办呢？可用 `normal!` 命令解决，故增加了这个 P
命令。

* `:P` 相当于 `normal! p`，原生粘贴于光标之后。
* `:P!` 相当于 `normal! P`，原生粘贴于光标之前。

P 命令也可再带一个参数，用于指定寄存器名，这一般在执行 `:reg` 查看寄存器内容后
有用。

* `:P x` 或 `:P -x`，转用可能被重映射的 p 命令，寄存器名 x 之前加 - 号表示粘贴
  在之前，即 P 命令。
* `:P! x` 或 `:P! -x` 转用原生的 p 或 P 命令，即 `normal!` 方式调用。

注意 ! 号在有参数与无参数了，选择了不同的意义。最可能用到的方式不加 ! 为原则。

从外面往运行在终端的 vim 复制文本时，可能需要 `set paste` 以获得正确的结果。为
了临时设置这个选项，可将 `set` 替换为上述的 `SET` 命令。

### CD: 改变路径命令

整合 [autojump](https://github.com/wting/autojump)
的目录功能，使用 `:lcd` 只改变当前窗口的路径

* `:CD` 回到 `~/.vim`
* `:CD .` 切换至当前编辑文档的路径，相当于 `&autochir` 选项
* `:CD /` 上溯回到项目根目录，如包含 `.git` 的目录
* `:CD -` 相当于 `:lcd -`
* `:CD ?` 列出 `autojump -s` 已记录的数据库
* `:CD path` 先用 autojump 查找快速进入的目录，再调用常规的 `lcd` 命令（所以也
  支持 `&cdpath` 配置），如果用常规 `lcd` 进入，则将新目录添加至 autojump 库。
  也支持多参数传给 autojump 。

如果没安装 autojump 也能用除此之外的功能。另外，单参数时在搜索 autojump 前还是
会先尝试 `~/.vim` 子目录的，如果全匹配的话。

### Q: 退出命令 

`:Q` 用于关闭整个标签页，相当于 `:tabclose`


### T: 终端系列命令

`:term` 默认是水平上下分隔窗口打开内置终端的
`:TV` 按垂直分隔窗口打开内置终端
`:TT` 在新标签页打开内置终端

## 安装使用

我不再为这类小功能插件维护独立仓库了。先安装 `autoplug`，然后 `:PI microcmd`
可开启这里的功能命令。

