# 开发笔记

一般流程：

1. 捕获输出至 message buffer
2. 快速过滤 buffer 行内容
3. 快捷键触发动作
4. 自动或快捷关闭消息窗口

两种捕获方式：

1. 内部命令，使用 echo 输出，转用 execute() 函数捕获
2. 外部命令，以 `!` 开头的，转用 system() 函数捕获

外部命令的两个工作方式：

1. 同步，简单命令直接用 system() 捕获输出
2. 异步，复杂超时命令考虑使用 `job_start()` 回调捕获

消息窗口与 qf 窗口差异，不考虑 errorformat 选项，展示原始输出，
有必要解析行格式时延迟到对单行触发动作时。

与 unite/denite 对比的特色：
扩展方便，只要定义命令向标准输出即可，内部命令使用 echo ，外部命令比如用 print

## 参考库

leaderf cli 用循环 getchar() 完全控制键入，echohl 显示在命令行，伪装成命令行输
入，此或可称为过滤模式。

## idea

输出行可反向 quckfix 格式，前导 || 表示定位，普通文本无前缀。
扩展 || 为行类型，默认 |QF|

* |QF| quickfix
* |FI| 文件
* |DI| 目录
* |BF| buffer
* |GP| grep 格式

然后又可能只需要 GP 不需要 QF ？本质一样的定位。
还可能实现智能猜测是否文件（目录）及可能带上的行号列号

## getchar 直接处理键入总结

回车：13 \r
换行：10 \n
ESC ：27
BS  : "\<BS>"
`<C-H>` : 8 转字符的话显示 ^H
`<C-C>` : 会直接终止，似乎不能捕获

光标闪烁通过 hi Cursor 模拟

## 开发进程

2019-11-04 捕获输出——过滤——执行的基本流程框架完成，剩下美化、优化与发现 bug 调
试等工作。还需扩展更多命令，外部命令若用异步则对框架还需较大调整。

重要扩展命令：File, Tag, Grep, Line

## 重要提示

使用内部命令时建议`verbose` 选项保持默认 0 ，否则有额外输出，增加解析输出消息
的复杂度。
